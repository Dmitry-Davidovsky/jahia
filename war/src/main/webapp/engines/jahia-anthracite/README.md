
  
# Anthracite Anthracite is an CSS/JS overlay for Jahia Default UI Edition. Fires events based on DOM changes.    
    
## Get started 

### Start working

- First, run ``yarn install`` to install dev dependencies for gulp.
- To see local modifications on js file, simply run gulp generate or npm run build, and copy and paste the core-min.js file instead of your local core-min-.js instance of Jahia. (In your Tomcat) 
- To see CSS modifications, watch edit.scss and compile it and replace it in your Tomcat instance's files.


### Build core-min.js
Before a commit, run ``gulp generate`` to build compressed version of anthracite edit.js located in ``/js/dist/core-min.js``    

## Documentation    

The Anthracite overlay core is located in, ``/war/src/main/webapp/engines/jahia-anthracite`` .
 
 This project is mainly composed by : 
 - fonts ( located in ./fonts/**)
 - images assets ( located in ./images/**)
 - JS sources that provide the anthracite-min.js file required for some DOM manipulations ( located in ./js/**) - see bellow
 - SCSS sources that provide CSS overlay.
 
 JS and SCSS are compiled with the compilation defined in en pom.xml file.
 
 #### JS files
  
 The anthracite-min.js file embed all interface interactions that require a DOM change or restructuration it's generated by the gulpfile.js in ``` ./js/dist/build```.     
 Anthracite fires events based on DOM changes and execute callback based on events.    

 In each JS sources files used to create the anthracite-min.js bundle you will find some JSDoc documentation before each functions. You will find more details also in [confluence](https://confluence.jahia.com/display/PR/Edit.js+documentation)     
 
 - dependencies.js  : provides utilities functions and a **jQuery** like named DexV2 but faster. 
 - edit.js  : provides the main IIFE function that init trigger the init.
 - eventListeners.js  : provides the huge list of listeners used in anthracite segmented by applications regions.
 - localisedString.js  : provides a i18n alternative for dynamic content.
 - methods.js  : provides function in callback of eventsListeners. (*DX*)
 
*DX* and *DexV2* are the two main function of Anthracite. The first one, **DexV2** is like a little **jQuery** but faster. 

#### Understand element flow  
First, the element receive and event listener and this one is associated with a callback related to his functional scope, for exemple *edit* for edit engine . The modification is applied when trigger the event. 
 
  
## Dev mode  
Inside methods.js tou can enable a dev mode that show all events and callback
```
 dev: {
        data: {
            on: false // Switch to true to enable it
        },
  }
   
```
   
 ## Warning    
 ###   DOM edition based on class    
 Communication is IMPOSSIBLE between GWT and Anthracite. The only reason Anthracite exists is because it spies constantly on GWT and sniffs its every move. I wrote listeners that look for changes in the DOM ( classnames, attributes, additions, mutations, deletions ). From these changes I was able to deduce the state of the application.    
    
The problem with sniffing for changes in the DOM is timing. Timing is very tricky as sometimes a class can be added leading you to believe that an element will be available in the DOM, but low and behold, the element that you are expecting to find in the DOM gets added five hundredths of a second later, so if you run code that is meant to affect that DOM element you are in trouble - because it isnâ€™t there yet    
    
### Z-index & onClick events    
 Anthracite is using incrementation of z-index based on clicks on triggers of absolutes components. It's could create strange side-effects of elements that never appear on firsts clicks. In this cas, override the component in the component.scss file with a z-index superior to the necessary value and likely add `!important`    
    
 ### JavaScript Hoisting    
 In JavaScript, a variable can be declared after it has been used.In other words; a variable can be used before it has been declared.    
 This phenomenon is the source of many bugs in anthracite. be careful


 ## License  
 Anthracite in a Jahia product.
